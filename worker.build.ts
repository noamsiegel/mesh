import { createYoga } from 'graphql-yoga';
import { buildSubgraphSchema } from '@apollo/subgraph';
import { parse } from 'graphql';

// Import environment variables
import './loadEnv';

// In production, this will be replaced with the actual schema content during build
// For local development, we'll use a placeholder
const supergraphSchema = process.env.SUPERGRAPH_SCHEMA || "\nschema\n  @link(url: \"https://specs.apollo.dev/link/v1.0\")\n  @link(url: \"https://specs.apollo.dev/join/v0.3\", for: EXECUTION)\n  \n  \n  \n  \n  \n  @link(\n  url: \"https://the-guild.dev/graphql/mesh/spec/v1.0\"\n  import: [\"@httpOperation\", \"@transport\", \"@extraSchemaDefinitionDirective\"]\n)\n{\n  query: Query\n  \n  \n}\n\n\n  directive @join__enumValue(graph: join__Graph!) repeatable on ENUM_VALUE\n\n  directive @join__field(\n    graph: join__Graph\n    requires: join__FieldSet\n    provides: join__FieldSet\n    type: String\n    external: Boolean\n    override: String\n    usedOverridden: Boolean\n  ) repeatable on FIELD_DEFINITION | INPUT_FIELD_DEFINITION\n\n  directive @join__graph(name: String!, url: String!) on ENUM_VALUE\n\n  directive @join__implements(\n    graph: join__Graph!\n    interface: String!\n  ) repeatable on OBJECT | INTERFACE\n\n  directive @join__type(\n    graph: join__Graph!\n    key: join__FieldSet\n    extension: Boolean! = false\n    resolvable: Boolean! = true\n    isInterfaceObject: Boolean! = false\n  ) repeatable on OBJECT | INTERFACE | UNION | ENUM | INPUT_OBJECT | SCALAR\n\n  directive @join__unionMember(graph: join__Graph!, member: String!) repeatable on UNION\n\n  scalar join__FieldSet\n\n\n  directive @link(\n    url: String\n    as: String\n    for: link__Purpose\n    import: [link__Import]\n  ) repeatable on SCHEMA\n\n  scalar link__Import\n\n  enum link__Purpose {\n    \"\"\"\n    `SECURITY` features provide metadata necessary to securely resolve fields.\n    \"\"\"\n    SECURITY\n\n    \"\"\"\n    `EXECUTION` features provide metadata necessary for operation execution.\n    \"\"\"\n    EXECUTION\n  }\n\n\n\n\n\n\n\nenum join__Graph {\n  TRAVELPORT @join__graph(name: \"Travelport\", url: \"https://api.travelport.com/12/hotel/search/\") \n}\n\ndirective @httpOperation(\n  subgraph: String\n  path: String\n  operationSpecificHeaders: [[String]]\n  httpMethod: HTTPMethod\n  isBinary: Boolean\n  requestBaseBody: ObjMap\n  queryParamArgMap: ObjMap\n  queryStringOptionsByParam: ObjMap\n  jsonApiFields: Boolean\n  queryStringOptions: ObjMap\n) repeatable on FIELD_DEFINITION\n\ndirective @transport(\n  subgraph: String\n  kind: String\n  location: String\n  headers: [[String]]\n  queryStringOptions: ObjMap\n  queryParams: [[String]]\n) repeatable on SCHEMA\n\ndirective @extraSchemaDefinitionDirective(directives: _DirectiveExtensions)  repeatable on OBJECT\n\n\"\"\"\nA field whose value is a generic Universally Unique Identifier: https://en.wikipedia.org/wiki/Universally_unique_identifier.\n\"\"\"\nscalar UUID @join__type(graph: TRAVELPORT) \n\n\"\"\"\nRepresents date values\n\"\"\"\nscalar Date @join__type(graph: TRAVELPORT) \n\n\"\"\"\nA date-time string at UTC, such as 2007-12-03T10:15:30Z, compliant with the `date-time` format outlined in section 5.6 of the RFC 3339 profile of the ISO 8601 standard for representation of dates and times using the Gregorian calendar.\n\"\"\"\nscalar DateTime @join__type(graph: TRAVELPORT) \n\n\"\"\"\nA field whose value conforms to the standard internet email address format as specified in HTML Spec: https://html.spec.whatwg.org/multipage/input.html#valid-e-mail-address.\n\"\"\"\nscalar EmailAddress @join__type(graph: TRAVELPORT)  @specifiedBy(url: \"https://html.spec.whatwg.org/multipage/input.html#valid-e-mail-address\") \n\n\"\"\"\nA time string at UTC, such as 10:15:30Z, compliant with the `full-time` format outlined in section 5.6 of the RFC 3339profile of the ISO 8601 standard for representation of dates and times using the Gregorian calendar.\n\"\"\"\nscalar Time @join__type(graph: TRAVELPORT) \n\n\"\"\"\nA field whose value conforms to the standard URL format as specified in RFC3986: https://www.ietf.org/rfc/rfc3986.txt.\n\"\"\"\nscalar URL @join__type(graph: TRAVELPORT) \n\nscalar ObjMap @join__type(graph: TRAVELPORT) \n\nscalar _DirectiveExtensions @join__type(graph: TRAVELPORT) \n\ntype Query @extraSchemaDefinitionDirective(\n  directives: {transport: [{subgraph: \"Travelport\", kind: \"rest\", location: \"https://api.travelport.com/12/hotel/search/\", headers: [[\"Authorization\", \"Bearer eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwianRpIjoiOWFxcWNldDFtdmhyIn0..gDPNK7o0eFCs9VSu6Q0XQA.hn2ZeJrPIGTaKmS8R1CZlmb3Zg8idBjoeOl_f8wmg1Yt0EJ851HoHXkNgQbTF_-NreCWlOfdCzzCvuGvrHX2IQNWHTE6dgbBJtdOGr0qE8k31tGuz1hL0NVr2kNh6Qt43tlw6BBzC0dU57EP5xNlJ5qxX4a1g2_q--paMWAqN3gqnkRK2cDypCKu7TjQo6DI4IhKgSrksqzT-BM1aF99kOFw5zGbdfANeeVGxT0IsweJWxuJGQtaKUL1BwVM-EE31-4yFy5mG7MuQLIvp4RQmFrTQ1K_I24dp2hBcLpiA2vb2D5INm2VLGGcBixXfM8mcGTX4z4uKzyYV_Ai9nhjG7D0GcZQFFKCZ3N5IN08xlNDEul0ChXAzPpE2l4MQRtbwMfw8mgo2danOCexw1Wkshj6RjO_xq1PEt8rkihT813OJWjGMmh9v5481Eb4k5KFLe3dUguanAYu_ofaeRDcnYevOsPyPkvni-uHz3tX--krQGDCi1yC0Y2-muawYW23CgmnLOiBaWLL4TobmM8JXA47SmsoPzszTDDjz8KHUnK8euscnF4asko2oweBCGLXuEN1axy8rXmfAClUFT8sPCKTFsiTZffUh6Xp7alTbSqcFO0T8xtyNqHnqgqYb6Bt4IDn_mmz9FF8j15W3Xgbxygw1i5uxanrxstRt2_CKaOZN5fQ2hpMW7g0xnF7F47i3m1tbIRGxORJ9TTioaj4AKjsdn0BtIfrAnyoDLPcB2kquwbcaN5PHI64GJUVDcEgaZxFfaE6jrw92WFeuelZn3A5gC9OraFcOq3NvErTh7de3Ta9AfowVeCvKtXCJTpPcghpfoJGEZ44caiA7-UefQvFWY7al0R__mubjTAQk5P5_cmZo74UIj18bND8wlHk5DzIbRj6zyM5UsaR-2reNkHHzDvwVns-y5QwrnA93eVjtbXYulZaiz1TCisswIQoKBavEOxwsp__ImY1aRVRm71zk0ipIos_APeANryBfN3ttPguN6arnVJBigFvEL6oqr_jNZjW1dp1kFt5W2aLG6C58coNZo__KPOi04QNXo0HmPUuM8AEoSpSlcWVer7bkvOKZ8rk4IDaTcn50dhnJO0IXAwrwiz6v9auxZNOHe7YR3qHQZNYwOhXbmElguj3kcSZS9yquYGUIvZiSYHajLMG3GVUDh6R-f1fTFF69ZawuBJFVc7FewTKPVgayT0Wp1KKOD3H1eUlAKpqs0olb73Nm1TFAudPE14L83exI_TAn2lTYAXa_BFJz2ruqnA_HpNuCWAo_MXutKwhQ-lX0pUKfjnL2TRiVc2MPNAu8aRHKd-9cxnvwjAIpcJln3zncKKshem_1p_phlxmO4d8rxz7RPSx7sZoyQg0g9us2y8ws8QNY3Dkr4DCcggG7Arf2dEY4hGnuL0y3aLObMXAKxnutREP9irt4W0Zv7CLvjEEA7GoDmIRrd4uPz_32pmmsHbwD16diAE6OIPe15Dhj8-_mbytn7ClgrrcYXn2JMGQxOl4T59V3dHRFYoCivkdyKnG8NXqsnw9YnBklwfOnN22REiNPP4E69CNv7ICG-UTuEEAAKFPjd6-1keMoMOil66e7lYtWtjBHr4VuGMEMoNp0StTeEEO6hOiU44kMmaWwwq38w87jHGaywwW8xaJ6r1seme5jyQa0Q4uXV9ps2qO2OAPgjlnGtcfw638-K46kKi8oSHwoaghxXg1Djc3WYViYWYulSFGPtDB6MHMSNJBoUsrBce193kJXOhgzezE1u8wUhgp1vnCKrHzvS1Rsn2wW5JmjhMKE8FTphSlIh9ZOGGFBIpukQOpw36SDi_fgIYwaCwsVT2jU6ROn5WamPwkwWdk7C7nwoQT75JIEsoWvzR0JwK4ruro41BT5k7yQbTSW0pjt9f-T9bZ7OFcM4VFucV2hOaPKW_wZJa37KYsFKin3d4bY_cY6UBSXi_eQsNUqCBuyFXi85Ld9CBe_QDVrrzQfM4XnlTZvdNK0OIXYYePwyvef2O8PHgs9skJohPzLgRT04rwF4GxEJCIMw6N6iHK4PEZSx1RoFFYhmyW8g3DcpspxDOgvzONUH56tI7vTHbg7XutLxw27FuWFTJzh6hEu4ErUOU5-6QoqaeFtk-POm25vG2ahIYYaFITjWqc3bJLqA0X8Qpqsb0wv2UgnrMw3EE5NJwzNb1fp36MHKdjEzPxZUyIbaIEE7dAQCh90YEBYxcSBgw0AzeoNa2HCY604lqTLrxquXcGGgFhfMa0arANYIOptNlpDZedWxtBzUlTSKhtkuquexZ2fVQbi837RL-l-QZrqmwOrLLL2O-CooGhi2DpYSCl8cxJ2iq5X2LjxyNFYA9wKPGUsXV8W3S0YGvh3Rt0R1r5kuAQIB-2QpQXoXvpgWSuRfO7dQag0AI68foGMX5MgbPMlFk2oalppNpLtVE6MyN-jE4s2i3dySVV3mhz75XQeQVFxCFAd1E3UTtIL1AzsE-My8ha6RunrB1BbbpRDhwnuU-HWsa5DEfrLi3RNCG2AIuXc3meFzvxCwXa_V28JlEc_01mPnxHE_TE6f3F6y5_miVOVUfjCDdYZ2O6uH1a3SP4-b0wXNeb7uIL80xovm7SacY-nql530d0cMdpGSkkEPn3ug9ncsHuj-VzMcwv7zc.VqO67V7QPQ-kbMGkOpuW7Q\"], [\"Content-Type\", \"application/json\"], [\"Accept\", \"application/json\"], [\"XAUTH_TRAVELPORT_ACCESSGROUP\", \"B77E15BA-1597-4855-A87D-29873BA56DF2\"]]}]}\n) @join__type(graph: TRAVELPORT)  {\n  searchHotels(input: CoordinatesHotelSearchRequest_Input) : query_searchHotels @httpOperation(subgraph: \"Travelport\", path: \"/searchcomplete\", httpMethod: POST) \n}\n\ntype query_searchHotels @join__type(graph: TRAVELPORT)  {\n  traceId: UUID!\n  transactionId: UUID!\n  pagination: Pagination!\n  hotelsResponse: HotelsResponse!\n}\n\ntype Pagination @join__type(graph: TRAVELPORT)  {\n  page: Int!\n  pageSize: Int!\n  totalPages: Int!\n  totalItems: Int!\n  paginationToken: UUID!\n}\n\ntype HotelsResponse @join__type(graph: TRAVELPORT)  {\n  searchPoint: SearchPoint!\n  checkInDateLocal: Date!\n  checkOutDateLocal: Date!\n  currencyExchangeRates: [CurrencyExchangeRatesItems]!\n  propertyItems: [PropertyItemsItems]!\n}\n\ntype SearchPoint @join__type(graph: TRAVELPORT)  {\n  latitude: Float!\n  longitude: Float!\n}\n\ntype CurrencyExchangeRatesItems @join__type(graph: TRAVELPORT)  {\n  sourceCurrency: String!\n  targetCurrency: String!\n  conversionFactor: Float!\n}\n\ntype PropertyItemsItems @join__type(graph: TRAVELPORT)  {\n  name: String!\n  chainCode: String!\n  propertyCode: String!\n  dataQualitySummaryScore: DataQualitySummaryScore!\n  availability: Boolean!\n  lowestPublicAvailableRate: LowestPublicAvailableRate!\n  propertyInfo: PropertyInfo!\n  roomTypes: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items]!\n  lowestPrivateAvailableRate: LowestPrivateAvailableRate\n  brandCode: String\n  availabilityNotes: [query_searchHotels_hotelsResponse_propertyItems_items_availabilityNotes_items]\n  longDescription: String\n}\n\ntype DataQualitySummaryScore @join__type(graph: TRAVELPORT)  {\n  propertySummary: PropertySummary!\n}\n\ntype PropertySummary @join__type(graph: TRAVELPORT)  {\n  merchandisingQualityScore: Int!\n  propertyContentQualityScore: Int!\n  averageAugmentedRateQualityScore: Int!\n  averageAugmentedRoomQualityScore: Int!\n}\n\ntype LowestPublicAvailableRate @join__type(graph: TRAVELPORT)  {\n  totalPrice: TotalPrice!\n  base: Base!\n  averageNightlyTotalPrice: AverageNightlyTotalPrice!\n  averageNightlyBase: AverageNightlyBase!\n  currencyCode: String!\n  rateKey: RateKey!\n  rateCodeInfo: RateCodeInfo!\n  shortRoomDescription: String!\n  terms: Terms!\n  totalTaxes: TotalTaxes\n  averageNightlyTotalTaxes: AverageNightlyTotalTaxes\n}\n\ntype TotalPrice @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype Base @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype AverageNightlyTotalPrice @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype AverageNightlyBase @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype RateKey @join__type(graph: TRAVELPORT)  {\n  value: String!\n  authority: String!\n}\n\ntype RateCodeInfo @join__type(graph: TRAVELPORT)  {\n  rateCategoryCode: Int!\n  rateType: String!\n  rateClassificationCode: Int!\n}\n\ntype Terms @join__type(graph: TRAVELPORT)  {\n  guaranteeType: String!\n  customerLoyaltyIDRequiredAtReservation: Boolean!\n  rateQualificationIDRequiredAtCheckIn: Boolean!\n  refundable: Boolean!\n  cancelPenalties: [CancelPenaltiesItems]!\n  description: [String]!\n  ratePaymentInfo: String\n}\n\ntype CancelPenaltiesItems @join__type(graph: TRAVELPORT)  {\n  deadlineLocal: DateTime!\n  cancelShortDescription: String!\n  penalty: Penalty!\n  estimatedDeadlineLocal: Boolean\n}\n\ntype Penalty @join__type(graph: TRAVELPORT)  {\n  estimatedAmount: Boolean!\n  currencyAmount: CurrencyAmount!\n  originalPenaltyInfo: String\n}\n\ntype CurrencyAmount @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n  currency: String!\n}\n\ntype TotalTaxes @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype AverageNightlyTotalTaxes @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype PropertyInfo @join__type(graph: TRAVELPORT)  {\n  geolocation: Geolocation!\n  distanceFromSearchPoint: DistanceFromSearchPoint!\n  address: Address!\n  phone: Phone!\n  adaCompliant: Boolean!\n  ratings: [RatingsItems]!\n  amenities: [AmenitiesItems]!\n  featuredPropertyInd: Boolean!\n  acceptedCreditCards: [String]\n  email: EmailAddress\n  checkInTimeLocal: Time\n  fax: Fax\n  imageURLs: [ImageURLsItems]\n}\n\ntype Geolocation @join__type(graph: TRAVELPORT)  {\n  center: Center!\n}\n\ntype Center @join__type(graph: TRAVELPORT)  {\n  latitude: Float!\n  longitude: Float!\n}\n\ntype DistanceFromSearchPoint @join__type(graph: TRAVELPORT)  {\n  unitOfDistance: String!\n  value: Float!\n}\n\ntype Address @join__type(graph: TRAVELPORT)  {\n  street: String!\n  city: String!\n  countryCode: String!\n  postalCode: String!\n  stateProvince: String\n}\n\ntype Phone @join__type(graph: TRAVELPORT)  {\n  phoneNumber: String!\n}\n\ntype RatingsItems @join__type(graph: TRAVELPORT)  {\n  value: Int!\n  provider: String!\n}\n\ntype AmenitiesItems @join__type(graph: TRAVELPORT)  {\n  description: String!\n  code: Int!\n  category: String!\n}\n\ntype Fax @join__type(graph: TRAVELPORT)  {\n  phoneNumber: String!\n}\n\ntype ImageURLsItems @join__type(graph: TRAVELPORT)  {\n  curatedImage: Boolean!\n  imageSize: String!\n  caption: String!\n  dimensions: Dimensions!\n  pictureCategory: Int!\n  url: URL!\n}\n\ntype Dimensions @join__type(graph: TRAVELPORT)  {\n  width: Int!\n  height: Int!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items @join__type(graph: TRAVELPORT)  {\n  estimatedRoomTypeOTACode: Int!\n  shortRoomDescription: String!\n  characteristics: Characteristics!\n  bedTypes: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_bedTypes_items]!\n  rates: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items]!\n  view: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_view\n  maxOccupancy: Int\n  roomAmenities: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_roomAmenities_items]\n  roomImageURLs: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_roomImageURLs_items]\n}\n\ntype Characteristics @join__type(graph: TRAVELPORT)  {\n  category: Category!\n  bedTypes: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_characteristics_bedTypes_items]!\n  view: View\n  maxOccupancy: Int\n  class: Class\n  otherFeatures: [String]\n  accessible: Boolean\n  locationInfo: LocationInfo\n}\n\ntype Category @join__type(graph: TRAVELPORT)  {\n  code: Int!\n  description: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_characteristics_bedTypes_items @join__type(graph: TRAVELPORT)  {\n  bedType: String!\n  quantity: Int!\n  size: String!\n}\n\ntype View @join__type(graph: TRAVELPORT)  {\n  code: Int!\n  description: String!\n}\n\ntype Class @join__type(graph: TRAVELPORT)  {\n  code: Int!\n  description: String!\n}\n\ntype LocationInfo @join__type(graph: TRAVELPORT)  {\n  floor: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_bedTypes_items @join__type(graph: TRAVELPORT)  {\n  bedType: String!\n  quantity: Int!\n  size: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items @join__type(graph: TRAVELPORT)  {\n  rateKey: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_rateKey!\n  bookingCode: String!\n  rateDescription: String!\n  roomDescription: String!\n  rateCodeInfo: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_rateCodeInfo!\n  dataQualityScore: DataQualityScore!\n  nonSmoking: Boolean!\n  price: Price!\n  terms: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms!\n  wifiIncluded: Boolean\n  accessibleRoom: Boolean\n  breakfastIncluded: Boolean\n  lunchIncluded: Boolean\n  dinnerIncluded: Boolean\n  quantity: Int\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_rateKey @join__type(graph: TRAVELPORT)  {\n  value: String!\n  authority: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_rateCodeInfo @join__type(graph: TRAVELPORT)  {\n  rateCategoryCode: Int!\n  rateType: String!\n  rateClassificationCode: Int!\n  rateCategory: String\n}\n\ntype DataQualityScore @join__type(graph: TRAVELPORT)  {\n  augmentedRateQualityScore: Int!\n  augmentedRoomQualityScore: Int!\n}\n\ntype Price @join__type(graph: TRAVELPORT)  {\n  currencyCode: String!\n  base: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_base!\n  totalPrice: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_totalPrice!\n  taxesIncludedInBase: Boolean!\n  commission: Commission!\n  nightlyRatesBreakdown: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_nightlyRatesBreakdown_items]!\n  priceNote: PriceNote!\n  totalTaxes: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_totalTaxes\n  perStayTaxAndFeeBreakdown: PerStayTaxAndFeeBreakdown\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_base @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_totalPrice @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype Commission @join__type(graph: TRAVELPORT)  {\n  application: Boolean!\n  percent: Int\n  estimatedPercent: Boolean\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_nightlyRatesBreakdown_items @join__type(graph: TRAVELPORT)  {\n  totalPrice: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_nightlyRatesBreakdown_items_totalPrice!\n  localDate: Date!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_nightlyRatesBreakdown_items_totalPrice @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype PriceNote @join__type(graph: TRAVELPORT)  {\n  message: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_totalTaxes @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype PerStayTaxAndFeeBreakdown @join__type(graph: TRAVELPORT)  {\n  taxes: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_perStayTaxAndFeeBreakdown_taxes_items]!\n  fees: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_perStayTaxAndFeeBreakdown_fees_items]\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_perStayTaxAndFeeBreakdown_taxes_items @join__type(graph: TRAVELPORT)  {\n  taxCode: String!\n  description: String!\n  value: Value\n}\n\ntype Value @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_perStayTaxAndFeeBreakdown_fees_items @join__type(graph: TRAVELPORT)  {\n  value: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_perStayTaxAndFeeBreakdown_fees_items_value!\n  taxCode: String!\n  description: String!\n  feeApplication: String!\n  feeFrequency: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_price_perStayTaxAndFeeBreakdown_fees_items_value @join__type(graph: TRAVELPORT)  {\n  amount: Int!\n  currency: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms @join__type(graph: TRAVELPORT)  {\n  guaranteeType: String!\n  refundable: Boolean!\n  cancelPenalties: [query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms_cancelPenalties_items]!\n  customerLoyaltyIDRequiredAtReservation: Boolean\n  rateQualificationIDRequiredAtCheckIn: Boolean\n  ratePaymentInfo: String\n  description: [String]\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms_cancelPenalties_items @join__type(graph: TRAVELPORT)  {\n  deadlineLocal: DateTime!\n  cancelShortDescription: String!\n  penalty: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms_cancelPenalties_items_penalty!\n  estimatedDeadlineLocal: Boolean\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms_cancelPenalties_items_penalty @join__type(graph: TRAVELPORT)  {\n  estimatedAmount: Boolean!\n  currencyAmount: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms_cancelPenalties_items_penalty_currencyAmount!\n  originalPenaltyInfo: String\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_rates_items_terms_cancelPenalties_items_penalty_currencyAmount @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n  currency: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_view @join__type(graph: TRAVELPORT)  {\n  code: Int!\n  description: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_roomAmenities_items @join__type(graph: TRAVELPORT)  {\n  description: String!\n  code: Int!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_roomImageURLs_items @join__type(graph: TRAVELPORT)  {\n  curatedImage: Boolean!\n  imageSize: String!\n  caption: String!\n  dimensions: query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_roomImageURLs_items_dimensions!\n  pictureCategory: Int!\n  url: URL!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_roomTypes_items_roomImageURLs_items_dimensions @join__type(graph: TRAVELPORT)  {\n  width: Int!\n  height: Int!\n}\n\ntype LowestPrivateAvailableRate @join__type(graph: TRAVELPORT)  {\n  totalPrice: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_totalPrice!\n  base: Base!\n  averageNightlyTotalPrice: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_averageNightlyTotalPrice!\n  averageNightlyBase: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_averageNightlyBase!\n  currencyCode: String!\n  rateKey: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_rateKey!\n  rateCodeInfo: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_rateCodeInfo!\n  shortRoomDescription: String!\n  terms: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms!\n  totalTaxes: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_totalTaxes\n  averageNightlyTotalTaxes: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_averageNightlyTotalTaxes\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_totalPrice @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_averageNightlyTotalPrice @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_averageNightlyBase @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_rateKey @join__type(graph: TRAVELPORT)  {\n  value: String!\n  authority: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_rateCodeInfo @join__type(graph: TRAVELPORT)  {\n  rateCategory: String!\n  rateCategoryCode: Int!\n  rateType: String!\n  rateClassificationCode: Int!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms @join__type(graph: TRAVELPORT)  {\n  guaranteeType: String!\n  customerLoyaltyIDRequiredAtReservation: Boolean!\n  rateQualificationIDRequiredAtCheckIn: Boolean!\n  refundable: Boolean!\n  cancelPenalties: [query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms_cancelPenalties_items]!\n  description: [String]!\n  ratePaymentInfo: String\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms_cancelPenalties_items @join__type(graph: TRAVELPORT)  {\n  deadlineLocal: DateTime!\n  cancelShortDescription: String!\n  penalty: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms_cancelPenalties_items_penalty!\n  estimatedDeadlineLocal: Boolean\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms_cancelPenalties_items_penalty @join__type(graph: TRAVELPORT)  {\n  estimatedAmount: Boolean!\n  currencyAmount: query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms_cancelPenalties_items_penalty_currencyAmount!\n  originalPenaltyInfo: String\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_terms_cancelPenalties_items_penalty_currencyAmount @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n  currency: String!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_totalTaxes @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_lowestPrivateAvailableRate_averageNightlyTotalTaxes @join__type(graph: TRAVELPORT)  {\n  amount: Float!\n}\n\ntype query_searchHotels_hotelsResponse_propertyItems_items_availabilityNotes_items @join__type(graph: TRAVELPORT)  {\n  authority: String!\n  message: String!\n}\n\nenum HTTPMethod @join__type(graph: TRAVELPORT)  {\n  GET @join__enumValue(graph: TRAVELPORT) \n  HEAD @join__enumValue(graph: TRAVELPORT) \n  POST @join__enumValue(graph: TRAVELPORT) \n  PUT @join__enumValue(graph: TRAVELPORT) \n  DELETE @join__enumValue(graph: TRAVELPORT) \n  CONNECT @join__enumValue(graph: TRAVELPORT) \n  OPTIONS @join__enumValue(graph: TRAVELPORT) \n  TRACE @join__enumValue(graph: TRAVELPORT) \n  PATCH @join__enumValue(graph: TRAVELPORT) \n}\n\ninput CoordinatesHotelSearchRequest_Input @join__type(graph: TRAVELPORT)  {\n  responseFields: [String]\n  requestedCurrency: String\n  stayDetails: queryInput_searchHotels_input_stayDetails_Input\n  propertyFilter: queryInput_searchHotels_input_propertyFilter_Input\n  roomFilter: queryInput_searchHotels_input_roomFilter_Input\n  rateFilter: queryInput_searchHotels_input_rateFilter_Input\n}\n\ninput queryInput_searchHotels_input_stayDetails_Input @join__type(graph: TRAVELPORT)  {\n  checkInDateLocal: String!\n  checkOutDateLocal: String!\n  rooms: Float!\n  guests: queryInput_searchHotels_input_stayDetails_guests_Input!\n}\n\ninput queryInput_searchHotels_input_stayDetails_guests_Input @join__type(graph: TRAVELPORT)  {\n  adults: Float!\n  children: [queryInput_searchHotels_input_stayDetails_guests_children_items_Input]\n}\n\ninput queryInput_searchHotels_input_stayDetails_guests_children_items_Input @join__type(graph: TRAVELPORT)  {\n  age: Float\n}\n\ninput queryInput_searchHotels_input_propertyFilter_Input @join__type(graph: TRAVELPORT)  {\n  maxWaitTime: Float\n  location: queryInput_searchHotels_input_propertyFilter_location_Input\n  chainCodes: [String]\n  customerLoyaltyCards: [queryInput_searchHotels_input_propertyFilter_customerLoyaltyCards_items_Input]\n  hotelNameContains: String\n  negotiatedRates: queryInput_searchHotels_input_propertyFilter_negotiatedRates_Input\n  returnOnlyAvailableProperties: Boolean\n  imageSize: String\n  returnAllImageURLs: Boolean\n  recommendedPropertyAmenitiesInd: Boolean\n  removeSpecialRates: Boolean\n  categories: [String]\n}\n\ninput queryInput_searchHotels_input_propertyFilter_location_Input @join__type(graph: TRAVELPORT)  {\n  type: String!\n  details: queryInput_searchHotels_input_propertyFilter_location_details_Input!\n  radius: queryInput_searchHotels_input_propertyFilter_location_radius_Input!\n}\n\ninput queryInput_searchHotels_input_propertyFilter_location_details_Input @join__type(graph: TRAVELPORT)  {\n  latitude: String!\n  longitude: String!\n}\n\ninput queryInput_searchHotels_input_propertyFilter_location_radius_Input @join__type(graph: TRAVELPORT)  {\n  value: Float!\n  unit: String!\n}\n\ninput queryInput_searchHotels_input_propertyFilter_customerLoyaltyCards_items_Input @join__type(graph: TRAVELPORT)  {\n  value: String\n  supplierCode: String\n  supplierType: String\n}\n\ninput queryInput_searchHotels_input_propertyFilter_negotiatedRates_Input @join__type(graph: TRAVELPORT)  {\n  rateCodes: [String]\n  masterRateCode: String\n}\n\ninput queryInput_searchHotels_input_roomFilter_Input @join__type(graph: TRAVELPORT)  {\n  nonSmoking: Boolean\n  balcony: Boolean\n  accessible: Boolean\n  connecting: Boolean\n  family: Boolean\n  bedConfiguration: queryInput_searchHotels_input_roomFilter_bedConfiguration_Input\n  amenityCodes: [Float]\n  recommendedRoomAmenitiesInd: Boolean\n}\n\ninput queryInput_searchHotels_input_roomFilter_bedConfiguration_Input @join__type(graph: TRAVELPORT)  {\n  minimumQuantity: Float\n  type: String\n}\n\ninput queryInput_searchHotels_input_rateFilter_Input @join__type(graph: TRAVELPORT)  {\n  rateFlags: queryInput_searchHotels_input_rateFilter_rateFlags_Input\n  publicRateBlacklist: [String]\n}\n\ninput queryInput_searchHotels_input_rateFilter_rateFlags_Input @join__type(graph: TRAVELPORT)  {\n  refundable: Boolean\n  commissionable: Boolean\n  deposit: Boolean\n  prepay: Boolean\n  postpay: Boolean\n  breakfast: Boolean\n  lunch: Boolean\n  dinner: Boolean\n}\n    ";

// Create a GraphQL yoga server
const yoga = createYoga({
  schema: buildSubgraphSchema({
    typeDefs: parse(supergraphSchema),
    resolvers: {
      // Your resolvers will be handled by the mesh gateway
    }
  }),
  graphiql: true,
  landingPage: false,
  cors: true
});

// Export for Cloudflare Workers
export default {
  fetch: (request: Request, env: any, ctx: any) => {
    // Simple router
    const url = new URL(request.url);
    
    // Health check endpoint
    if (url.pathname === '/') {
      return new Response('GraphQL Mesh Gateway is running! Go to /graphql to use the API.', {
        status: 200,
        headers: {
          'Content-Type': 'text/plain'
        }
      });
    }
    
    // GraphQL endpoint
    if (url.pathname === '/graphql') {
      // Set environment variables from Cloudflare
      Object.keys(env).forEach(key => {
        process.env[key] = env[key];
      });
      
      return yoga.fetch(request, env, ctx);
    }
    
    // 404 for all other routes
    return new Response('Not Found', {
      status: 404,
      headers: {
        'Content-Type': 'text/plain'
      }
    });
  }
}; 